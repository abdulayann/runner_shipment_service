## This file will be used to deploy the service repo

# General application info
organization: dpwhotfsonline
productName: runner
azureProject: DTLP
appName: runner-shipment-service
repoName: runner_shipment_service
repoId: cdeb2aab-0be8-4566-bbba-421a13f55ec5
serviceType: backend
language: JAVA
buildTool: maven
branching: Release
infra: K8s
containerRegistryURL: acrcargoesrunner.azurecr.io
libraryVariableGroupName: runner_runner_shipment_service
libraryVariableGroupId: 
allEnvironments: ['development', 'qa', 'test', 'staging', 'prod','production','dr']
bluegreen: True
artifactAliasName: _config
artifactVstsFeedPublish: 
containerRegistrySC: ACR_Cargoes Runner
artifactsFeeds: runner-artifactory
jdkVersion: 1.17
mavenOptions: 


# Service configuration
service:
  name: runner-shipment-service-svc
  type: ClusterIP
  port: 80
  targetPort: 8080

# ConfigMap configuration
configMap:
  name: runner-shipment-service-cm
  data:
    NEW_RELIC_ENABLED: true
    NEW_RELIC_LOG_ENABLED: true
    NEW_RELIC_DISTRIBUTED_TRACING_ENABLED: true
    NEW_RELIC_LOG_LEVEL: info

# Horizontal Pod Autoscaler (HPA) configuration
hpa:
  name: runner-shipment-service-hpa
  enabled: true
  avgCpuUtil: 80
  stableSec: 300
  scaleUpCount: 1
  scaleUpSec: 60

# Deployment configuration
deployment:
  name: runner-shipment-service-deployment
  imageName: runner-shipment-service
  imageTag: latest
  port: 8080
  healthCheck: /actuator/health
  
# Ingress configuration
ingress:
  name: runner-shipment-service-ingress
  annotations:
    kubernetes.io/ingress.class: nginx
  rules:
    - paths:
        - path: /
          pathType: ImplementationSpecific
          serviceName: runner-shipment-service-svc
          servicePort: 80

# SecretProvider configuration
secretprovider:
  name: runner-shipment-service-secretproviderclass
  nonProdUserAssignedIdentityID: 8d0b30ff-0856-4315-9eab-906063f174bb
  nonProdKeyVaultName: cargoesrunner-nonprod-kv
  prodUserAssignedIdentityID: d50883f6-2c0a-4fdb-b659-6176f5fb0be5
  prodKeyVaultName: kv-cargorunner-prod
  drUserAssignedIdentityID: d50883f6-2c0a-4fdb-b659-6176f5fb0be5
  drKeyVaultName: kv-cargorunner-prod
  tenantId: 2bd16c9b-7e21-4274-9c06-7919f7647bbb


development:
  cicd: Full
  envName: development
  namespace: runner-shipment-service-development-ns
  hpa:
    minReplicas: 1
    maxReplicas: 3
  hostUrlList: 
  - development-runner-shipment-service.dpworld.com
  configMap:
    data:
      APP_ENV: development
      NEW_RELIC_APP_NAME: runner-shipment-service-development
  secretName: runner-shipment-service-development-SECRET
  deployment:
    replicaCount: 1
    args: cat /mnt/secrets-store/runner-shipment-service-development-SECRET >> ~/.bashrc && . ~/.bashrc  && java -Xms256m -Xmx750m -javaagent:/usr/local/newrelic/newrelic.jar -jar runner-shipment-service.jar
    minCpu: 300m
    maxCpu: 500m
    minMem: 512Mi
    maxMem: 1Gi


test:
  cicd: Full
  envName: test
  namespace: runner-shipment-service-test-ns
  hpa:
    minReplicas: 1
    maxReplicas: 3
  hostUrlList: 
  - test-runner-shipment-service.dpworld.com
  configMap:
    data:
      APP_ENV: test
      NEW_RELIC_APP_NAME: runner-shipment-service-test
  secretName: runner-shipment-service-test-SECRET
  deployment:
    replicaCount: 1
    args: tar -xvzf /tmp/config.tar -C /app/ && cat /mnt/secrets-store/runner-shipment-service-test-SECRET >> ~/.bashrc && . ~/.bashrc  && java -Xms256m -Xmx750m -javaagent:/usr/local/newrelic/newrelic.jar -jar runner-shipment-service.jar
    minCpu: 300m
    maxCpu: 500m
    minMem: 512Mi
    maxMem: 1Gi

staging:
  cicd: Full
  envName: staging
  namespace: runner-shipment-service-staging-ns
  hpa:
    minReplicas: 1
    maxReplicas: 3
  hostUrlList: 
  -  staging-runner-shipment-service.dpworld.com
  configMap:
    data:
      APP_ENV: staging
      NEW_RELIC_APP_NAME: runner-shipment-service-staging
  secretName: runner-shipment-service-staging-SECRET
  deployment:
    replicaCount: 1
    args: cat /mnt/secrets-store/runner-shipment-service-staging-SECRET >> ~/.bashrc && . ~/.bashrc  && java -Xms256m -Xmx750m -javaagent:/usr/local/newrelic/newrelic.jar -jar runner-shipment-service.jar
    minCpu: 300m
    maxCpu: 500m
    minMem: 512Mi
    maxMem: 1Gi

production:
  cicd: Full
  envName: production
  namespace: runner-shipment-service-production-ns
  hpa:
    minReplicas: 2
    maxReplicas: 5
  hostUrlList: 
  - runner-shipment-service.dpworld.com
  configMap:
    data:
      APP_ENV: production
      NEW_RELIC_APP_NAME: runner-shipment-service-production
  secretName: runner-shipment-service-production-SECRET
  deployment:
    replicaCount: 1
    args: cat /mnt/secrets-store/runner-shipment-service-production-SECRET >> ~/.bashrc && . ~/.bashrc  && java -Xms256m -Xmx750m -javaagent:/usr/local/newrelic/newrelic.jar -jar runner-shipment-service.jar
    minCpu: 300m
    maxCpu: 500m
    minMem: 512Mi
    maxMem: 1Gi

dr:
  cicd: Full
  envName: dr
  namespace: runner-shipment-service-dr-ns
  hpa:
    minReplicas: 1
    maxReplicas: 5
  hostUrlList: 
  - runner-shipment-service.dpworld.com
  configMap:
    data:
      APP_ENV: dr
      NEW_RELIC_APP_NAME: runner-shipment-service-dr
  secretName: runner-shipment-service-dr-SECRET
  deployment:
    replicaCount: 0
    args: cat /mnt/secrets-store/runner-shipment-service-dr-SECRET >> ~/.bashrc && . ~/.bashrc  && java -Xms256m -Xmx750m -javaagent:/usr/local/newrelic/newrelic.jar -jar runner-shipment-service.jar
    minCpu: 300m
    maxCpu: 500m
    minMem: 512Mi
    maxMem: 1Gi